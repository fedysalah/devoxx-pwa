<html>
    <head>
        <title>Devoxx - PWA Showcase</title>
        <meta http-equiv="Content-Type"content="text/html; charset=utf-8">
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
        <link rel="stylesheet" href="../assets/css/style.css"/>
        <style>
            #status {
                width: 100%;
                font: bold 1em sans-serif;
                padding: 0.5em;
            }
            .btn {
                position: relative;
                padding: 8px 30px;
                border: 0;
                margin: 10px 1px;
                cursor: pointer;
                border-radius: 2px;
                text-transform: uppercase;
                text-decoration: none;
                color: rgba(0,0,0,.84);
                transition: background-color .2s ease,box-shadow .28s cubic-bezier(.4,0,.2,1);
                border: 1px solid rgba(0,0,0,.84);
            }
        </style>
        
    </head>
    <body>
        <nav>
            <img src="../assets/images/devoxx_brand.gif" width="183" height="25" class="responsive-img logo-vis" alt="Devoxx Belgium">
            <h1><a href="../index.html">PWA Showcase</a></h1>
            <span class="twitter-account">@gsoldera / @fedysalah</span>
        </nav>
        <div class="content">
            <h2>Mobile behavior - Notification</h2>
            
            <div id="status">
                <p>Current permission status is <b id="permission-status">unavailable</b>.</p>

                <button class="btn btn-default" onclick="requestPermission()">Request permission</button>
                <button class="btn btn-default" onclick="nonPersistentNotification()">Non-persistent notification</button>
                <button class="btn btn-default" onclick="persistentNotification()">Persistent notification (in 3s)</button>
            </div>
            <div id="log">

            </div>
        </div>
        
        <script>

                var $permissionStatus = document.getElementById('permission-status');
                var $statusContainer = document.getElementById('status')
                var $logContainer = document.getElementById('log');
                if ('Notification' in window) {
                    $permissionStatus.innerText = Notification.permission;
                } else {
                    $statusContainer.innerHTML = '<p>Notification API not supported</p>'
                }

                function requestPermission() {
                    Notification.requestPermission(function (result) {
                        $permissionStatus.innerText = result;
                    });
                }

                function nonPersistentNotification() {
                    try {
                        var notification = new Notification("This is a non-persistent notification!");
                    } catch (err) {
                        $logContainer.innerHTML = '<p>Error : ' + err.message + '</p>'
                    }
                }

                function persistentNotification() {
                    if (!('Notification' in window) || !('ServiceWorkerRegistration' in window)) {
                        alert('Persistent Notification API not supported!');
                        return;
                    }
                
                    setTimeout(() => {
                        try {
                            navigator.serviceWorker.getRegistration('/')
                            .then(reg => reg.showNotification("Hi there - persistent!"))
                            .catch(err => $logContainer.innerHTML = '<p>Error : ' + err.message + '</p>');
                        } catch (err) {
                            $logContainer.innerHTML = '<p>Error : ' + err.message + '</p>'
                        }
                    }, 3000)
                }
            </script>
    </body>
</html>